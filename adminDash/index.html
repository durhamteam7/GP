
<html>
	<head>
		<title>Admin Dashboard</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/locale/en-gb.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/angularjs-slider/2.10.2/rzslider.min.css"/>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.js"></script>
		<script src="https://cdn.upress.co.il/ajax/libs/angularjs-slider/2.9.0/rzslider.js"></script>
		<script src="http://bouil.github.io/angular-google-chart/ng-google-chart.js"></script>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script src="checklistModel.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>
		<script src="angular-toggle-switch.min.js"></script>
		<link href="angular-toggle-switch.css" media="all" rel="stylesheet" type="text/css">
		<script src="https://rawgit.com/brantwills/Angular-Paging/v2.2.0/dist/paging.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css">
		
		<script src="https://cdn.rawgit.com/diosney/angular-bootstrap-datetimepicker-directive/master/angular-bootstrap-datetimepicker-directive.js"></script>

		    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCpzag5AVnm8nqYpPnO_7kku6siPeNxLO0&libraries=places"></script>
		    <script src="ngAutocomplete.js"></script>

		
		<script src="app.js"></script>
		<script src="filters.js"></script>
		<style>
		body {
			-webkit-touch-callout: none; /* iOS Safari */
			-webkit-user-select: none;   /* Chrome/Safari/Opera */
			-khtml-user-select: none;    /* Konqueror */
			-moz-user-select: none;      /* Firefox */
			-ms-user-select: none;       /* IE/Edge */
		user-select: none;           /* non-prefixed version, currently
		not supported by any browser */
		}
		.knob{
			color: #f5f5f5;
		}
		.switch-right{
			color: white !important;
			background-color: #0db9f0 !important;
		}
		.switch-left{
			color: white !important;
			background-color: #0db9f0 !important;
		}

		</style>
		<link rel="stylesheet" href="loader.css">
		
	</head>
	<body ng-controller="MainController" ng-App="adminDash">
		{{details}}
		<div id="loader">
			<div>
				<div class="spinner"></div>
				<p>Loading...</p>
			</div>
		</div>
		<div class="container">
			<div class="page-header">
				<h1>Welcome Admin</h1>
			</div>
			<div class="row">
				<div class="col-md-3" id="leftCol">
					<div class="well" id="filters">
						    <div class="row">
						    	<div class='col-md-2'></div>
						    	<div class='col-md-34'>
							    <toggle-switch class="switch-default" on-label='Sequence' off-label='Image' ng-model="isSequence"></toggle-switch>
								</div>
							</div>
						<br>

						<form>
							<span ng-repeat="filterCat in filters">
							<span ng-repeat="filterData in filterCat | orderObjectBy | orderBy: 'order'">
								
								<h4>{{readable(filterData.id)}}</h4>

								<span ng-if="filterData.type=='checkboxes'">
									<div ng-repeat="s in filterData.struc">
										<span ng-if="filterData.struc.length > 1">
											<b>{{readable(s)}}</b>
										</span>
										<div class="checkbox" ng-repeat="(id,name) in options[s] | objectLimitTo:(!filterData.open[s]?3:(options[s] | keylength))">
											<label>
												<input type="checkbox" checklist-model="filterData.value" checklist-value="id"> {{name}}
											</label>

										</div>
											<span ng-if="(options[s] | keylength)> 5">
												<a href="javascript:void(0)" ng-click="filterData.open[s]=!filterData.open[s]">{{filterData.open[s]?"-":"+"}} See {{filterData.open[s]?"less":"more"}}</a>
											</span>
									</div>
									
								</span>

								<span ng-if="filterData.type=='boolean'">
									<div class="checkbox">
										<label>
											<input type="checkbox" checklist-model="filterData.value" checklist-value="true" ng-click="((filterData.value.length==1)?(filterData.value=[true]):1)"> Yes
										</label>

									</div>
									<div class="checkbox">
										<label>
											<input type="checkbox" checklist-model="filterData.value" checklist-value="false" ng-click="((filterData.value.length==1)?(filterData.value=[false]):1)"> No
										</label>
									</div>
								</span>

								<div class="row" ng-if="filterData.type=='slider'">
									<rzslider rz-slider-model="filterData.minValue" rz-slider-high="filterData.maxValue" rz-slider-options="filterData.options"></rzslider>
									<div class="col-md-6">
										<input type="number" class="form-control" step="1" ng-model="filterData.minValue"  />
									</div>
									<div class = "col-md-6">
										<input type="number" class="form-control" step="1" ng-model="filterData.maxValue"  />
									</div>
								</div>
								<div class="row" ng-if="filterData.type=='dateTime'">
									
								<div class='col-md-12'>
								<div class="form-group">
									<div class='input-group date' id='datetimepicker6'>
										<input type='text' class="form-control" placeholder="from..." datetimepicker ng-model="filterData.minValue" datetimepicker-options="{{filterData.options}}" />
										<span class="input-group-addon">
										<span class="glyphicon {{filterData.icon}}"></span>
									</span>
									</div>
								</div>
							</div>
								
							<div class='col-md-12'>
								<div class="form-group">
									<div class='input-group date' id='datetimepicker6'>
										<input type='text' class="form-control" placeholder="...to" datetimepicker ng-model="filterData.maxValue" datetimepicker-options="{{filterData.options}}" />
										<span class="input-group-addon">
										<span class="glyphicon {{filterData.icon}}"></span>
									</span>
									</div>
								</div>
							</div>	
								
									
								</div>
								<br>
							</span>
							</span>
							<h4>OTHER</h4>
							
							<b>Location</b><br>
							
							<label>Postcode:</label>
								<div class='input-group'>
									<input type="text" class="form-control" ng-model="autocomplete" ng-autocomplete options="options" details="details" lat="filters.Site.lat.value" lon="filters.Site.lon.value" >
									<span class="input-group-addon">
										<span class="glyphicon glyphicon-map-marker"></span>
									</span>

								</div>
								<br>
								<div class='input-group'>
									<input type="number" class="form-control" placeholder="radius">
								</div>
							</label>
							<!-- users
							gender
							age
							time period (seconds if poss)
							site (arbitary geographical aRea)
							sequence
							habitat type
							human presence
							blank images
							number of classifications
							concencus/mannual checking -->
							<!-- need a table of sites -->
						</form>
					</div>
				</div>
				<div class="col-md-6">
					<h2 id="sec0">Search Results</h2>
					<h5>
					<span ng-repeat="filterCat in filters">
					<span ng-repeat="(name,f) in filterCat">
						<span class="label label-default" style="font-weight:normal;margin:5px" ng-if="f.type=='slider' && (f.minValue!=f.options.floor || f.maxValue!=f.options.ceil)">{{readable(name)}}:
							<b>
							<span ng-if="f.minValue!=f.options.floor">&gt;= {{f.minValue}}</span> <span ng-if="f.maxValue!=f.options.ceil">&lt;= {{f.maxValue}}</span>
							</b>
							<a href="javascript:void(0)" style="color:white" ng-click="f.minValue=f.options.floor;f.maxValue=f.options.ceil;"><span class="glyphicon glyphicon-remove"></span></a>
						</span>

						<span class="label label-default" style="font-weight:normal;margin:5px" ng-if="f.type=='boolean' && f.value.length>0">
							{{readable(name)}}:
							<b>
								{{(f.value[0]?'yes':'no')}}
							</b>
							<a href="javascript:void(0)" style="color:white" ng-click="f.value=[]"><span class="glyphicon glyphicon-remove"></span></a>
						</span>

						<span class="label label-default" style="font-weight:normal;margin:5px" ng-if="f.type=='dateTime' && f.minValue!=''">
							{{readable(name)}}:
							<b>
								{{f.minValue!=""?'>='+f.minValue:''}} {{f.maxValue!=""?'<='+f.maxValue:''}}
							</b>
							<a href="javascript:void(0)" style="color:white" ng-click="f.minValue='';f.maxValue=''"><span class="glyphicon glyphicon-remove"></span></a>
						</span>

						<span class="label label-default" style="font-weight:normal;margin:5px" ng-if="f.type=='checkboxes'" ng-repeat="v in f.value">{{readable(name)}}:
							<b>
							{{getOptionName(v)}}
							</b>
							<a href="javascript:void(0)" style="color:white" ng-click="f.value.splice(f.value.indexOf(v),1)" ><span class="glyphicon glyphicon-remove"></span></a>
						</span>

						<span class="label label-default" style="font-weight:normal;margin:5px" ng-if="f.type=='coord'&&f.value!=null">{{readable(name)}}:
							<b>
							{{f.value}}
							</b>
							<a href="javascript:void(0)" style="color:white" ng-click="f.value=null" ><span class="glyphicon glyphicon-remove"></span></a>
						</span>
					</span>
					</span>
					</h5>
					<div id="searchResults">
						<div class="row"  ng-repeat="result in results">
							<div class="col-sm-4">
								<div class="row">
									<div class="col-sm-4">
										<a data-toggle="modal" data-target="#{{result.Photo.photo_id}}" href="javascript:void(0)">
											<img ng-src="{{result.Photo.URL}}" width=150>
										</a>
									</div>
								</div>
							</div>
							<div class="col-sm-8">
								<div class="row">
									<div class="col-sm-5"><b>{{(isSequence?result.Photo.sequence_id:((result.Photo.upload_filename | limitTo: 15 | newlines) ))}}

										{{(result.Photo.upload_filename.length > 15 && !isSequence)?'...' : '' }}

</b></div>
								</div>
								<div class="row" ng-if="!isSequence">
									<div class="col-sm-3">Sequence:</div>
									<div class="col-sm-8">{{result.Photo.sequence_id}}</div>
								</div>
								<div class="row">
									<div class="col-sm-3">Site:</div>
									<div class="col-sm-8"><a href="#">{{result.Site.site_name}}</a></div>
								</div>
								<div class="row">
									<div class="col-sm-3">Time:</div>
									<div class="col-sm-8">{{result.Photo.taken | date:'dd/MM/yyyy HH:mm'}}</div>
								</div>
								<div class="row">
									<div class="col-sm-3">Animals:</div>
									<div class="col-sm-8"><a ng-repeat="c in result.Classification" href="#">{{getOptionName(c.species)}} </a></div>
								</div>
								<br>
							</div>
						</div>
					</div>
					<hr>
					
        <div>
            <p>Showing {{numResults == 0 ? 0 : ((currentPage-1) * pageSize) + 1}} to {{rowsShown()}} of {{numResults}} entries</p>
        </div>
        <div class="row">	
            <div paging page="currentPage" page-size="pageSize" total="numResults" paging-action="getResults(page)" hide-if-empty="true" show-prev-next="true" show-first-last="true"></div> 
   		 </div>
					
					
					
					
				</div>
				<div class="col-md-3" id="rightCol">
					<div class="well">
						<h1 class="h4">Summary</h1>
						{{numResults}} results.
					</div>
					<div class="well" ng-controller="GraphsController">
						<h1 class="h4">Graphs</h1>
						<button type="button" class="btn" data-toggle="modal" data-target="#graphModal" >Open Graph Editor</button>
						
						<!-- Modal -->
						<div id="graphModal" class="modal fade" role="dialog">
							<div class="modal-dialog modal-lg">
								<!-- Modal content-->
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal">&times;</button>
										<h4 class="modal-title">Graph Editor</h4>
									</div>
									<div class="modal-body">
										<div class= "row">
											<div google-chart chart="chartObject" style="{{chartStyle}}"></div>
										</div>

										<div class="row">
											<div class="col-xs-8">
												<div class= "row">
													<div class="form-group">
														<label for="type" class="col-sm-2 control-label">Chart Type:</label>
														<div class="col-sm-10">
															<select class="form-control ng-pristine ng-valid" id="chartType" ng-model="chartObject.type" ng-change="chartSelectionChange()">
																<option ng-repeat="type in chartTypes" ng-value="type">{{type}}</option>
															</select>
														</div>
													</div>
												</div>
												<div class= "row">
													<div class="form-group">
														<label for="x-axis" class="col-sm-2 control-label">x-axis Label:</label>
														<div class="col-sm-10">
															<select class="form-control ng-pristine ng-valid" id="x-axis" ng-model="xName" ng-change="chartSelectionChange();makeData();">
																	<option ng-hide="1" ng-repeat-start="(catName,filterCat) in filters" ng-value="filterName">
																	</option>
																	<option ng-repeat-end ng-repeat="(filterName,filterData) in filterCat" ng-value='(catName + "." + filterName)'>{{readable(filterName)}}</option>
																
															</select>
														</div>
													</div>
												</div>
												<div class="row">
													<div class="form-group">
														<label for="y-axis" class="col-sm-2 control-label">y-axis Label:</label>
														<div class="col-sm-10">
															<select class="form-control ng-pristine ng-valid" id="y-axis" ng-model="yName" ng-change="chartSelectionChange();makeData();">
																	<option ng-hide="1" ng-repeat-start="(catName,filterCat) in filters">
																	</option>
																	<option ng-repeat-end ng-repeat="(filterName,filterData) in filterCat" ng-value='(catName + "." + filterName)'>{{readable(filterName)}}</option>
																	<option value="countOfXaxis">COUNTOF({{readable(xName)}})</option>
																
															</select>
														</div>
													</div>
												</div>
											</div>
											<div class="col-xs-4">
												<div class="row">
													<button type="button" class="btn btn-danger"  ng-click="getFullResults()">Use Full Dataset</button>
												</div>
												<div class="row">
													<p>Warning: There are {{numResults}} results.<br>This may take a long time to load</p>
												</div>
											</div>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="well">
						<h1 class="h4">Export CSV</h1>
						<button class="btn" ng-click="downloadCSV()">Download CSV</button>
					</div>

					<div class="well">
						<h1 class="h4">User Ratings</h1>
						<button class="btn" data-toggle="modal" data-target="#userModal">View Users</button>
						<!--Modal-->
						<div id="userModal" class="modal fade" role="dialog">
							<div class="modal-dialog modal-lg">
								<!-- Modal content-->
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal">&times;</button>
										<h4 class="modal-title">Users</h4>
									</div>
									<div class="modal-body" style="height:80%;overflow:scroll;margin-bottom:15px;">
										<div class="row">
											<div class="col-xs-12">
												<table class="table table-bordered table-hover">
									                <thead>
									                    <tr>
									                        <th ng-repeat="key in personTableOrder">
								                                {{ readable(key) }}
									                        </th>
									                    </tr>
									                </thead>
									                <tbody>
									                	<tr ng-repeat="p in persons | orderBy :'weighted_average'">
									                		<td class="col-xs-1">
									                			{{p.person_id}}
									                		</td>
									                		<td class="col-xs-1">
									                			{{p.number_of_classifications}}
									                		</td>
									                		<td ng-repeat="key in personTableOrder" ng-if="key!='person_id' && key!='number_of_classifications'" class="col-xs-2">
									                			<div class="progress">
									                			  {{value=p[key];""}}
																  <div class="progress-bar" role="progressbar" aria-valuenow="{{value}}"
																  aria-valuemin="0" aria-valuemax="1" style="width:{{value*100}}%;background-color:{{
																  value==1?'#33cc33':(
																  value>0.9?'#bbee55':(
																  value>0.75?'#ffee22':(
																  value>0.5?'#ffcc00':(
																  value>0.25?'ff6600':
																  '#dd0000'))))}}">
																    {{value}}
																  </div>
																</div>
									                		</td>
									                	</tr>
									                </tbody>
									            </table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<div id="{{result.Photo.photo_id}}" class="modal fade" role="dialog" ng-repeat="result in results">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{result.Photo.upload_filename}}</h4>
      </div>
      <div class="modal-body">
      	<a ng-href="{{result.Photo.URL}}" target="_blank">
        <img ng-src="{{result.Photo.URL}}" width=400>
    </a>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


</body>
</html>
